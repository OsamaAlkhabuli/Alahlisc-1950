<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ - Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø·Ø±Ø§Ø¨Ù„Ø³</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: white;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background-color: #006400;
      color: goldenrod;
      padding: 15px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 10px;
      gap: 10px;
    }
    .tab-btn {
      background-color: goldenrod;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    .tab-btn.active {
      background-color: #006400;
    }
    .tab-content {
      display: none;
      padding: 20px;
    }
    .tab-content.active {
      display: block;
    }
    .filters {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .filters input, .filters select {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      min-width: 150px;
    }
    .export-buttons {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      flex-wrap: wrap;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      overflow-x: auto;
      display: block;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #006400;
      color: white;
    }
    .btn {
      background-color: goldenrod;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .filters input, .filters select {
        min-width: 100%;
      }
      table {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <header>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ Ù„Ù„Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø·Ø±Ø§Ø¨Ù„Ø³ - 2025</header>
  <nav>
    <button class="tab-btn active" onclick="showTab(0)">Ù…Ø³ØªÙˆÙÙŠ Ø§Ù„Ø¹Ù‚ÙˆØ¯</button>
    <button class="tab-btn" onclick="showTab(1)">Ù…Ø³ØªÙˆÙÙŠÙ† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</button>
    <button class="tab-btn" onclick="showTab(2)">Ø¹Ù„ÙŠÙ‡Ù… Ø§Ù„ØªØ²Ø§Ù…</button>
    <button class="tab-btn" onclick="showTab(3)">Ù†ÙˆØ§Ù‚Øµ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</button>
    <button class="tab-btn" onclick="showTab(4)">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
  </nav>

  <div class="tab-content active" id="tab0">
    <div class="filters" id="filters0"></div>
    <div class="export-buttons">
      <button class="btn" onclick="exportToExcel(0)">ğŸ“¥ Excel</button>
      <button class="btn" onclick="exportToPDF(0)">ğŸ“„ PDF</button>
    </div>
    <div id="table0"></div>
  </div>
  <div class="tab-content" id="tab1">
    <div class="filters" id="filters1"></div>
    <div class="export-buttons">
      <button class="btn" onclick="exportToExcel(1)">ğŸ“¥ Excel</button>
      <button class="btn" onclick="exportToPDF(1)">ğŸ“„ PDF</button>
    </div>
    <div id="table1"></div>
  </div>
  <div class="tab-content" id="tab2">
    <div class="filters" id="filters2"></div>
    <div class="export-buttons">
      <button class="btn" onclick="exportToExcel(2)">ğŸ“¥ Excel</button>
      <button class="btn" onclick="exportToPDF(2)">ğŸ“„ PDF</button>
    </div>
    <div id="table2"></div>
  </div>
  <div class="tab-content" id="tab3">
    <div class="filters" id="filters3"></div>
    <div class="export-buttons">
      <button class="btn" onclick="exportToExcel(3)">ğŸ“¥ Excel</button>
      <button class="btn" onclick="exportToPDF(3)">ğŸ“„ PDF</button>
    </div>
    <div id="table3"></div>
  </div>
  <div class="tab-content" id="tab4">
    <h3>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
    <div id="dashboard" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;"></div>
    <canvas id="chartPhase" height="150"></canvas>
    <canvas id="chartPaid" height="150"></canvas>
    <canvas id="chartMonths" height="150"></canvas>
</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    function showTab(index) {
      document.querySelectorAll('.tab-content').forEach((tab, i) => {
        tab.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === index);
      });
    }

    function exportToExcel(index) {
      const table = document.querySelector(`#table${index} table`);
      const wb = XLSX.utils.table_to_book(table, {sheet: "Sheet1"});
      XLSX.writeFile(wb, `table${index}.xlsx`);
    }

    function exportToPDF(index) {
      const element = document.querySelector(`#table${index}`);
      const opt = {
        margin: 0.5,
        filename: `table${index}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
      };
      html2pdf().set(opt).from(element).save();
    }

    function generateTable(data, containerId) {
      if (!data || data.length === 0) return;
      const columns = Object.keys(data[0]);
      const filterContainer = document.getElementById('filters' + containerId.charAt(containerId.length - 1));
      filterContainer.innerHTML = '';

      const filters = {};
      ['Ø§Ù„Ù…Ø±Ø­Ù„Ø©', 'Ø§Ù„Ø¯ÙˆØ±', 'Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ù„', 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±', 'ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø³Ø¯Ø§Ø¯'].forEach(key => {
        const input = document.createElement(key === 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±' ? 'input' : 'select');
        input.setAttribute('data-key', key);
        input.placeholder = 'ğŸ” ' + key;
        if (key !== 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±') {
          const values = [...new Set(data.map(d => d[key]))].filter(Boolean);
          input.innerHTML = '<option value="">Ø§Ù„ÙƒÙ„</option>' + values.map(v => `<option value="${v}">${v}</option>`).join('');
        }
        input.oninput = input.onchange = () => applyFilters();
        filterContainer.appendChild(input);
        filters[key] = input;
      });

      function applyFilters() {
        const filtered = data.filter(row => {
          return Object.keys(filters).every(key => {
            const val = filters[key].value;
            return !val || (row[key] && row[key].toString().includes(val));
          });
        });
        drawTable(filtered);
      }

      function drawTable(filteredData) {
        let tableHTML = '<table><thead><tr>';
        columns.forEach(col => tableHTML += `<th>${col}</th>`);
        tableHTML += '</tr></thead><tbody>';
        filteredData.forEach(row => {
          tableHTML += '<tr>';
          columns.forEach(col => tableHTML += `<td>${row[col]}</td>`);
          tableHTML += '</tr>';
        });
        tableHTML += '</tbody></table>';
        document.getElementById(containerId).innerHTML = tableHTML;
      }

      applyFilters();
    }

    

      // Ø±Ø³Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø©
      const countByPhase = {};
      all.forEach(r => {
        const p = r['Ø§Ù„Ù…Ø±Ø­Ù„Ø©'] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        countByPhase[p] = (countByPhase[p] || 0) + 1;
      });
      new Chart(document.getElementById('chartPhase'), {
        type: 'pie',
        data: {
          labels: Object.keys(countByPhase),
          datasets: [{
            data: Object.values(countByPhase),
            backgroundColor: ['#66bb6a','#ffa726','#42a5f5','#ef5350','#ab47bc']
          }]
        },
        options: { plugins: { title: { display: true, text: 'ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©' } } }
      });

      // Ø±Ø³Ù… Ù…Ù† Ø¯ÙØ¹ÙˆØ§
      const paidDistribution = {};
      all.forEach(r => {
        const val = parseFloat(r['Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©']);
        if (val > 0) paidDistribution[val] = (paidDistribution[val] || 0) + 1;
      });
      new Chart(document.getElementById('chartPaid'), {
        type: 'bar',
        data: {
          labels: Object.keys(paidDistribution),
          datasets: [{
            label: 'Ø¹Ø¯Ø¯ Ù…Ù† Ø¯ÙØ¹ÙˆØ§ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ…Ø©',
            data: Object.values(paidDistribution),
            backgroundColor: '#42a5f5'
          }]
        },
        options: { plugins: { title: { display: true, text: 'ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©' } } }
      });

      // Ø±Ø³Ù… Ø­Ø³Ø¨ Ø£Ø´Ù‡Ø± Ø¢Ø®Ø± Ø³Ø¯Ø§Ø¯
      const monthCounts = {};
      all.forEach(r => {
        const date = r['ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø³Ø¯Ø§Ø¯'];
        if (date && date.length >= 7) {
          const month = date.substring(0, 7);
          monthCounts[month] = (monthCounts[month] || 0) + 1;
        }
      });
      new Chart(document.getElementById('chartMonths'), {
        type: 'bar',
        data: {
          labels: Object.keys(monthCounts),
          datasets: [{
            label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ø´Ù‡Ø±',
            data: Object.values(monthCounts),
            backgroundColor: '#66bb6a'
          }]
        },
        options: { plugins: { title: { display: true, text: 'ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø£Ø´Ù‡Ø± Ø§Ù„Ø³Ø¯Ø§Ø¯' } } }
      });
    }
    window.onload = function () {
      const url = 'alahlisc.json';
      fetch(url)
        .then(response => response.json())
        .then(data => {
          const datasets = [data.paid, data.commitment, data.outstanding, data.deficiencies];
          datasets.forEach((set, i) => generateTable(set, `table${i}`));
          renderDashboard(datasets);
        })
        .catch(error => console.error('Error loading data:', error));
    };
  </script>
</body>
</html>
